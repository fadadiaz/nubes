<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guía de Identificación de Nubes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:wght@400&display=swap">
  <link rel="stylesheet" href="https://use.typekit.net/oer0pgk.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=west" />
  <link rel="icon" type="image/x-icon" href="img/dot.ico">
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #fff;
      font-family: 'Alegreya Sans', sans-serif;
      color: #000;
      overflow: hidden;
    }

    .card {
      text-align: center;
      display: flex;
      min-width: 330px;
      gap: 20px;
      height: 90vh;
      flex-direction: column;
      align-items: center;
      padding: 16px;
      transition: filter 0.5s ease, -webkit-filter 0.5s ease;
    }

    .card.blur {
      -webkit-filter: blur(4px);
      filter: blur(4px);
    }

    .welcome-text, .question, .cloud-name {
      margin: 0;
      font-family: "ff-more-web-pro-condensed", serif;
      font-size: 49.06px;
      flex: 2;
      overflow-wrap: anywhere;
      display: flex;
      align-items: center;
    }

    .description {
      font-size: 18px;
      margin: 0;
      font-weight: 100;
      flex: 1;
    }

    .button-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
      max-width: 100vw;
      align-items: center;
      flex-grow: 1;
    }

    .button, .vamos, .si, .no, .restart {
      background-color: #fff;
      color: #000;
      padding: 10px;
      font-size: 20px;
      cursor: pointer;
      font-family: 'Alegreya Sans', sans-serif;
      text-transform: uppercase;
      font-weight: bold;
      border: 1px solid #000;
      width: 50vw;
      letter-spacing: 0.6pt;
      position: relative;
    }

    .back-button {
      background-color: #fff;
      color: #000;
      border: none;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Alegreya Sans', sans-serif;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .material-symbols-outlined {
      font-weight: 300;
    }

    .progress-container {
      position: fixed;
      top: 20px;
      width: 90vw;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .progress-bar {
      width: 100%;
      height: 1px;
      background-color: #000;
      position: relative;
    }

    .progress-dot {
      width: 15px;
      height: 15px;
      background-color: #000;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 0;
      transition: left 0.5s ease;
    }

    .button::after, .button::before {
      content: '';
      position: absolute;
      background-color: #000;
      pointer-events: none;
    }

    .derecha::after {
      width: 50vw;
      height: 1px;
      top: 50%;
      left: 100%;
      transform: translateY(-50%);
    }

    .abajo::after {
      width: 1px;
      height: 50vh;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    .izquierda::before {
      width: 50vw;
      height: 1px;
      top: 50%;
      right: 100%;
      transform: translateY(-50%);
    }

    .glossary {
      cursor: pointer;
      font-size: 0.6em;
      vertical-align: super;
      color: #000;
    }
    .glossary:hover::after {
      content: attr(title);
      position: absolute;
      background: #fff;
      border: 1px solid #000;
      padding: 5px;
      z-index: 1000;
      white-space: nowrap;
    }

    @media (min-width: 768px) {
      .card {
        gap: 60px;
        width: 90vw;
        flex-flow: wrap;
        justify-content: center;
        align-items: unset;
      }

      .welcome-text, .question {
        font-size: 99.06px;
        width: 60%;
        max-width: 820px;
      }

      .cloud-name {
        font-weight: 100;
        font-size: 99.06px;
        flex: 2 1 0%;
      }

      .description {
        flex: 1 1 0%;
      }

      .button-container {
        height: 100%;
        justify-content: center;
        width: 280px;
      }

      .button, .vamos, .si, .no {
        width: 100%;
      }

      .restart {
        width: 50vw;
      }

      .back-button {
        position: absolute;
        width: 90vw;
        text-align: left;
      }
    }
  </style>
</head>
<body>
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-dot" id="progress-dot"></div>
    </div>
  </div>
  <div class="card" id="card">
    <p class="welcome-text">Identificador de Nubes</p>
    <div class="button-container" id="buttons">
      <button class="button vamos" onclick="startQuiz()">¡Vamos!</button>
    </div>
  </div>

  <script>
    let currentState = "welcome";
    let history = [];
    const maxSteps = 5;

    const decisionTree = {
      welcome: { action: "start" },
      q1: {
        question: "¿Hay relámpagos o truenos?",
        yes: { result: { name: "Cumulonimbus", description: "Nube en forma de enorme torre, a veces con yunque. Posibilidad de tormenta." } },
        no: "q2"
      },
      q2: {
        question: "¿La nube tiene bultos o parece hinchada?",
        yes: "q3",
        no: "q4"
      },
      q3: {
        question: "¿El borde superior de la nube es nítido?",
        yes: { result: { name: "Cumulonimbus", description: "Nube en forma de enorme torre, a veces con yunque. Posibilidad de tormenta." } },
        no: { result: { name: "Cumulus", description: "Nube de aspecto algodonoso y separada de otras nubes, con contornos bien delimitados." } }
      },
      q4: {
        question: "¿La nube parece una capa extensa y lisa sin relieves?",
        yes: "q5",
        no: "q6"
      },
      q5: {
        question: "¿El Sol o la Luna se ven como un punto difuso?",
        yes: { result: { name: "Cirrostratus", description: "Velo nuboso transparente, de aspecto blanquecino o fibroso, que no tapa las sombras, da lugar al fenómeno del halo." } },
        no: "q7"
      },
      q7: {
        question: "¿La nube forma una capa alta de color grisáceo?",
        yes: { result: { name: "Altostratus", description: "Capa nubosa alargada y uniforme, que tapa las sombras aun cuando se pueden ver el Sol o la Luna vagamente." } },
        no: "q8"
      },
      q8: {
        question: "¿La nube es una capa baja oscura que podría traer lluvia?",
        yes: { result: { name: "Nimbostratus", description: "Nube oscura de lluvia o nube clara de nieve. Suele traer precipitaciones continuas." } },
        no: { result: { name: "Stratus", description: "Capa gris blanquecina en el nivel bajo, que puede generar llovizna o nieve en granos." } }
      },
      q6: {
        question: "¿La nube tiene filamentos<1> blancos y finos?<span class='glossary' title='Filamentos: Hilos delgados y elongados formados por cristales de hielo en nubes altas.'>1</span>",
        yes: { result: { name: "Cirrus", description: "Ganchos, plumas, bandas o bancos con un brillo sedoso." } },
        no: "q9"
      },
      q9: {
        question: "¿Los elementos<1> de la nube son pequeños como granos de arroz?<span class='glossary' title='Elementos: Partes individuales visibles de una nube, como gotas o cristales de hielo.'>1</span>",
        yes: { result: { name: "Cirrocumulus", description: "Capa delgada de pequeños gránulos u ondas, de color blanco puro, situados en el nivel alto." } },
        no: "q10"
      },
      q10: {
        question: "¿Los elementos<1> de la nube son redondos y del tamaño de un dedo?<span class='glossary' title='Elementos: Partes individuales visibles de una nube, como gotas o cristales de hielo.'>1</span>",
        yes: { result: { name: "Altocumulus", description: "Banco, manto o capa estructurado de nubes blancas o grises, con ondulaciones o rodillos." } },
        no: { result: { name: "Stratocumulus", description: "Campo, rodillo o bulto de nubes grises o blanquecinas, con contornos redondeados." } }
      }
    };

    function startQuiz() {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          currentState = "q1";
          displayQuestion();
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function answer(response) {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          history.push({ state: currentState, response: response });
          const currentNode = decisionTree[currentState];
          const next = currentNode[response];
          if (typeof next === "string") {
            currentState = next;
            displayQuestion();
          } else if (next && next.result) {
            displayResult(next.result);
          }
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function goBack() {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          if (history.length > 0) {
            history.pop();
            const previous = history[history.length - 1];
            if (previous) {
              currentState = previous.state;
              displayQuestion();
            } else {
              currentState = "q1";
              displayQuestion();
            }
          } else {
            // Volver a la página de bienvenida
            currentState = "welcome";
            card.innerHTML = `
              <p class="welcome-text">Identificador de Nubes</p>
              <div class="button-container" id="buttons">
                <button class="button vamos" onclick="startQuiz()">¡Vamos!</button>
              </div>
            `;
          }
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function displayQuestion() {
      const card = document.getElementById("card");
      card.innerHTML = `
        <button id="back-btn" class="back-button" onclick="goBack()" style="display: none;">
          <span class="material-symbols-outlined">west</span>
        </button>
        <p class="question" id="question">${decisionTree[currentState].question}</p>
        <div class="button-container" id="buttons">
          <button id="${currentState}-yes" class="button derecha si" onclick="answer('yes')">Sí</button>
          <button id="${currentState}-no" class="button abajo no" onclick="answer('no')">No</button>
        </div>
      `;
    }

    function displayResult(result) {
      const card = document.getElementById("card");
      card.innerHTML = `
        <button id="back-btn" class="back-button" onclick="goBack()" style="display: none;">
          <span class="material-symbols-outlined">west</span>
        </button>
        <h2 class="cloud-name">${result.name}</h2>
        <img src="/img/${result.name.toLowerCase()}.png" alt="${result.name}" style="max-width: 100%; height: auto; margin-top: 20px;">
        <div class="description">${result.description}</div>
        <div class="button-container" id="buttons">
          <button id="restart-btn" class="button restart" onclick="restart()">Volver a empezar</button>
        </div>
      `;
    }

    function restart() {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          currentState = "q1";
          history = [];
          displayQuestion();
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function updateProgress() {
      const progressDot = document.getElementById("progress-dot");
      const progressBarWidth = document.querySelector(".progress-bar").offsetWidth;
      const steps = history.length;
      const isResult = decisionTree[currentState] && decisionTree[currentState].result !== undefined;
      const isWelcome = currentState === "welcome";

      let progressPercent;
      if (isWelcome) {
        progressPercent = 0; // En la página de bienvenida, el progreso es 0
      } else if (isResult) {
        progressPercent = 100; // En la página de resultado, el progreso es 100%
      } else {
        progressPercent = (steps / maxSteps) * 100; // Durante las preguntas, el progreso depende de los pasos
      }

      const dotPosition = (progressPercent / 100) * (progressBarWidth - 15); // Ajustado para que el puntito no se salga
      progressDot.style.left = `${dotPosition}px`;
    }

    function toggleBackButton() {
      const backButton = document.getElementById("back-btn");
      const isResult = decisionTree[currentState] && decisionTree[currentState].result !== undefined;
      const isWelcome = currentState === "welcome";

      // Mostrar el botón de "volver" si estamos en una pregunta (q1 o posteriores) y no en un resultado
      backButton.style.display = (!isWelcome && !isResult) ? "block" : "none";
    }

    updateProgress();
    toggleBackButton();
  </script>
</body>
</html>
