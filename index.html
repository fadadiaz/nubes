<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guía de Identificación de Nubes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Alegreya+Sans:wght@400&display=swap">
  <link rel="stylesheet" href="https://use.typekit.net/oer0pgk.css">
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #fff;
      font-family: 'Alegreya Sans', sans-serif;
      color: #000;
      overflow: hidden;
    }

    .card {
      text-align: center;
      display: flex;
      flex-direction: column;
      max-width: 330px;
    }
  
    .card h2 {
      font-family: "ff-more-web-pro-condensed", serif;
      font-size: 39.06px;
      margin-bottom: 20px;
    }
  
    .card p {
      font-size: 18px;
      margin-bottom: 30px;
    }
  
    .button-container {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
  
    .button {
      background-color: #fff;
      color: #000;
      border: none;
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      font-family: 'Alegreya Sans', sans-serif;
    }
  
    .restart {
      background-color: #fff;
      color: #000;
      border: none;
      margin-top: 10px;
    }

    .back-button {
      background-color: #fff;
      color: #000;
      border: none;
      font-size: 14px;
      cursor: pointer;
      font-family: 'Alegreya Sans', sans-serif;
    }

    .progress-container {
      position: fixed;
      top: 20px;
      width: 90vw;
      height: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .progress-bar {
      width: 100%;
      height: 1px;
      background-color: #000;
      position: relative;
    }

    .progress-dot {
      width: 5px;
      height: 5px;
      background-color: #000;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 0;
      transition: left 0.3s ease;
    }

    /* 
    .derecha::after {
    content: '';
    width: 50%;
    height: 1px;
    margin: 8px 0 0 20px;
    }
  
    .abajo::after {
    width: 1px;
    height: 50%;
    margin: 43px 0 0 -9px;
    }
  
    .izquierda::before {
    width: 50%;
    height: 1px;
    left: 0;
    margin: 9px 0 0 -30px;
    } */
    .button::after, .button::before {
    content: '';
    position: absolute;
    background-color: #000;
    pointer-events: none;
    }
    #q1-yes::after {
    width: 50%;
    height: 1px;
    margin: 8px 0 0 20px;
    }
    #q1-no::after {
    width: 1px;
    height: 50%;
    margin: 43px 0 0 -9px;
    }
    #q2-yes::before {
    width: 50%;
    height: 1px;
    left: 0;
    margin: 9px 0 0 -30px;
    }
    #q2-no::after {
    content: '';
    width: 50%;
    height: 1px;
    margin: 8px 0 0 20px;
    }
  </style>
</head>
<body>
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-dot" id="progress-dot"></div>
    </div>
  </div>
  <div class="card" id="card">
    <button id="back-btn" class="back-button" onclick="goBack()" style="display: none;">Volver</button>
    <h2>Identificador de Nubes</h2>
    <p id="question">¿Se ven rayos o se oyen truenos?</p>
    <div class="button-container" id="buttons">
      <button id="q1-yes" class="button derecha si" onclick="answer('yes')">Sí</button>
      <button id="q1-no" class="button abajo no" onclick="answer('no')">No</button>
    </div>
  </div>

  <script>
    const decisionTree = {
      q1: {
        question: "¿Se ven rayos o se oyen truenos?",
        yes: {
          result: {
            name: "Cumulonimbus",
            description: "Nube en forma de enorme torre, a veces con yunque. Posibilidad de tormenta."
          }
        },
        no: "q2"
      },
      q2: {
        question: "¿Se ven claramente protuberancias o cúpulas?",
        yes: "q3",
        no: "q4"
      },
      q3: {
        question: "En el tercio alto de esta nube, ¿es nítido el contorno?",
        yes: {
          result: {
            name: "Cumulonimbus",
            description: "Nube en forma de enorme torre, a veces con yunque. Posibilidad de tormenta."
          }
        },
        no: {
          result: {
            name: "Cumulus",
            description: "Nube de aspecto algodonoso y separada de otras nubes, con contornos bien delimitados."
          }
        }
      },
      q4: {
        question: "¿Se observa una capa uniforme, continua o discontinua, sin rodillos ni elementos distintivos?",
        yes: "q5",
        no: "q6"
      },
      q5: {
        question: "¿Aparecen el Sol o la Luna en forma de parche luminoso?",
        yes: {
          result: {
            name: "Cirrostratus",
            description: "Velo nuboso transparente, de aspecto blanquecino o fibroso, que no tapa las sombras, da lugar al fenómeno del halo. (Nube de tipo stratus)"
          }
        },
        no: "q7"
      },
      q7: {
        question: "¿Observa una capa alta en forma de lámina y de color gris o entre azulado y oscuro?",
        yes: {
          result: {
            name: "Altostratus",
            description: "Capa nubosa alargada y uniforme, que tapa las sombras aun cuando se pueden ver el Sol o la Luna vagamente, como a través de un vidrio deslustrado. (Nube de tipo stratus)"
          }
        },
        no: "q8"
      },
      q8: {
        question: "¿Hay una capa baja densa y alargada poco definida que puede traer precipitaciones?",
        yes: {
          result: {
            name: "Nimbostratus",
            description: "Nube oscura de lluvia o nube clara de nieve. Suele traer precipitaciones continuas de lluvia, nieve o gránulos de hielo. (Nube de tipo stratus)"
          }
        },
        no: {
          result: {
            name: "Stratus",
            description: "Capa gris blanquecina en el nivel bajo, que puede generar llovizna o nieve en granos. Cuando el Sol o la Luna son visibles, su contorno está definido. Puede estar formado por elementos separados. (Nube de tipo stratus)"
          }
        }
      },
      q6: {
        question: "¿Hay filamentos o fibras blancos y finos?",
        yes: {
          result: {
            name: "Cirrus",
            description: "Ganchos, plumas, bandas o bancos con un brillo sedoso."
          }
        },
        no: "q9"
      },
      q9: {
        question: "¿Son todos los elementos pequeños que un dedo (brazo estirado)?",
        yes: {
          result: {
            name: "Cirrocumulus",
            description: "Capa delgada de pequeños gránulos u ondas, de color blanco puro, situados en el nivel alto. Tamaño < 1°."
          }
        },
        no: "q10"
      },
      q10: {
        question: "¿Son todos los elementos redondos del tamaño de 1 a 3 dedos (brazo estirado)?",
        yes: {
          result: {
            name: "Altocumulus",
            description: "Banco, manto o capa estructurado de nubes blancas o grises (de torreta, lenticulares o aborregadas), con ondulaciones o rodillos. Anchura: entre 1 – 3°."
          }
        },
        no: {
          result: {
            name: "Stratocumulus",
            description: "Campo, rodillo o bulto de nubes grises o blanquecinas, con contornos redondeados y situadas en el nivel bajo. Elementos dispuestos de forma regular. Anchura: 5 – 10° (5 dedos)."
          }
        }
      }
    };

    let currentState = "q1";
    let history = []; // Track the history of states and answers
    const maxSteps = 5; // Longest path in the decision tree

    function answer(response) {
      // Save current state and response to history before moving forward
      history.push({ state: currentState, response: response });

      const currentNode = decisionTree[currentState];
      const next = currentNode[response];

      if (typeof next === "string") {
        currentState = next;
        displayQuestion();
      } else if (next && next.result) {
        displayResult(next.result);
      }
      updateProgress();
      toggleBackButton();
    }

    function goBack() {
      if (history.length > 0) {
        // Remove the last entry from history
        history.pop();
        // Get the previous state from the last history entry, or reset to q1
        const previous = history.length > 0 ? history[history.length - 1] : null;
        if (previous) {
          currentState = previous.state;
          displayQuestion();
        } else {
          currentState = "q1";
          displayQuestion();
        }
        updateProgress();
        toggleBackButton();
      }
    }

    function displayQuestion() {
      const card = document.getElementById("card");
      const question = document.getElementById("question");
      const buttons = document.getElementById("buttons");

      card.querySelector("h2").textContent = "Identificador de Nubes";
      question.textContent = decisionTree[currentState].question;
      buttons.innerHTML = `
        <button id="${currentState}-yes" class="button derecha si" onclick="answer('yes')">Sí</button>
        <button id="${currentState}-no" class="button abajo no" onclick="answer('no')">No</button>
      `;
    }

    function displayResult(result) {
      const card = document.getElementById("card");
      const question = document.getElementById("question");
      const buttons = document.getElementById("buttons");

      card.querySelector("h2").textContent = result.name;
      question.textContent = result.description;
      buttons.innerHTML = `
        <button id="restart-btn" class="button restart" onclick="restart()">Volver a empezar</button>
      `;
    }

    function restart() {
      currentState = "q1";
      history = []; // Clear history on restart
      displayQuestion();
      updateProgress();
      toggleBackButton();
    }

    function updateProgress() {
      const progressDot = document.getElementById("progress-dot");
      const progressBarWidth = document.querySelector(".progress-bar").offsetWidth;
      const steps = history.length; // Number of questions answered
      const isResult = decisionTree[currentState].result !== undefined;

      // Calculate progress percentage: if at a result, show 100%; otherwise, base on steps
      const progressPercent = isResult ? 100 : (steps / maxSteps) * 100;
      const dotPosition = (progressPercent / 100) * (progressBarWidth - 8); // Subtract dot width for accuracy

      progressDot.style.left = `${dotPosition}px`;
    }

    function toggleBackButton() {
      const backButton = document.getElementById("back-btn");
      backButton.style.display = history.length > 0 ? "block" : "none";
    }

    // Initial setup
    updateProgress();
    toggleBackButton();
  </script>
</body>
</html>
