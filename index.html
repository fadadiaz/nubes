<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guía de Identificación de Nubes</title>
  <link rel="stylesheet" href="https://use.typekit.net/oer0pgk.css">
  <link rel="icon" type="image/x-icon" href="img/dot.ico">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background-color: #fff;
      font-family: "alegreya-sans", sans-serif;
      color: #000;
      overflow: hidden;
    }

    .card {
      text-align: center;
      display: flex;
      gap: 60px;
      width: 90vw;
      height: 80vh;
      flex-flow: wrap;
      justify-content: space-between;
      align-items: center;
      transition: filter 0.5s ease, -webkit-filter 0.5s ease;
      max-width: 80vw;
      flex-direction: column;
      align-content: center;
    }

    #card.welcome {
      max-height: 290px;
    }

    .card.blur {
      -webkit-filter: blur(4px);
      filter: blur(4px);
    }

    .welcome-text, .question, .cloud-name {
      font-family: "ff-more-web-pro-condensed", serif;
      font-size: 90px;
      text-align: center;
    }

    .cloud-name {
      font-weight: 100;
    }

    .description {
      font-size: 18px;
      margin: 0;
      font-weight: 100;
      flex: 1;
    }

    .button-container {
      width: 280px;
      gap: 10px;
      display: flex;
      flex-direction: column;
    }

    .button {
      background-color: #fff;
      color: #000;
      padding: 5px 8px 8px;
      font-size: 24px;
      cursor: pointer;
      font-family: "alegreya-sans-sc", sans-serif;
      text-transform: lowercase;
      font-weight: 500;
      border: 1px solid #000;
      width: 100%;
      letter-spacing: 0.6pt;
      display: flex;
      justify-content: center;
      position: relative;
    }

    .contenedor-volver {
      color: #000;
      border: none;
      font-size: 14px;
      font-family: "alegreya-sans", sans-serif;
      display: flex;
      gap: 5px;
      text-align: left;
    }
    .contenedor-principal {
      display: flex;
      width: 100%;
      flex-grow: 2;
      height: 100%;
      align-items: center;
      justify-content: center;
      gap: 60px;
    } 

    .pregunta, .respuesta {
      max-width: 860px;
    }

    .back-button {
      background-color: #fff;
      color: #000;
      border: none;
      cursor: pointer;
      font-family: "alegreya-sans", sans-serif;
    }

    .progress-container {
      position: fixed;
      top: 20px;
      width: 90vw;
      height: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .progress-bar {
      width: 100%;
      height: 1px;
      background-color: #000;
      position: relative;
    }

    .progress-dot {
      width: 15px;
      height: 15px;
      background-color: #000;
      border-radius: 50%;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 0;
      transition: left 0.5s ease;
    }

    .button::after, .button::before {
      content: '';
      position: absolute;
      background-color: #000;
      pointer-events: none;
    }

    .derecha::after {
      width: 50vw;
      height: 1px;
      top: 50%;
      left: 100%;
      transform: translateY(-50%);
    }

    .abajo::after {
      width: 1px;
      height: 50vh;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    .izquierda::before {
      width: 50vw;
      height: 1px;
      top: 50%;
      right: 100%;
      transform: translateY(-50%);
    }

    .glossary-term {
      border-bottom: 3px solid #000;
      cursor: pointer;
      display: inline;
    }

    .glossary-number {
      font-size: 0.6em;
      vertical-align: super;
      color: #000;
    }

    .glossary-popup {
      position: fixed;
      top: 0;
      left: -33%;
      width: 33%;
      height: 100%;
      background: #fff;
      border-right: 1px solid #000;
      padding: 20px;
      overflow-y: auto;
      transition: left 0.3s ease;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 45px;
    }

    .glossary-popup.open {
      left: 0;
    }

    .glossary-popup h3 {
      margin-top: 0;
      font-family: "ff-more-web-pro-condensed", serif;
      font-size: 90px;
      text-align: center;
      font-weight: 100;
    }

    .glossary-popup .close-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: none;
      border: none;
      font-size: 40px;
      cursor: pointer;
    }

    .glossary-popup ul {
      list-style: none;
      padding: 0;
      width: 500px;
      display: flex;
      flex-direction: column;
      gap: 40px;
    }

    .glossary-popup.open ul li {
      display: flex;
      flex-direction: column;
      font-size: 18px;
      gap: 5px;
    }

    .glossary-popup.open strong {
      font-family: "ff-more-web-pro-condensed", serif;
      font-size: 60px;
      text-align: left;
      font-weight: 100;
    }

    @media (max-width: 767px) {
      .card {
        gap: 20px;
        min-width: 330px;
        flex-direction: column;
        align-items: center;
      }

      .welcome-text, .question, .cloud-name {
        font-size: 49.06px;
        width: 100%;
        max-width: none;
      }

      .cloud-name {
        flex: 2;
      }

      .description {
        flex: 1;
      }

      .button-container {
        max-width: 100vw;
        width: auto;
        flex-grow: 1;
      }

      .button {
        width: 50vw;
      }

      .restart {
        width: 50vw;
      }

      .back-button {
        position: static;
        width: auto;
        text-align: center;
      }

      .glossary-popup {
        width: 66%;
        left: -66%;
      }

      .glossary-popup.open {
        left: 0;
      }
    }
  </style>
</head>
<body>
  <div class="progress-container">
    <div class="progress-bar">
      <div class="progress-dot" id="progress-dot"></div>
    </div>
  </div>
  <div class="card welcome" id="card">
    <p class="welcome-text">Identificador de Nubes</p>
    <div class="button-container" id="buttons">
      <button class="button vamos" onclick="startQuiz()">¡Vamos!</button>
    </div>
  </div>

  <script>
    let currentState = "welcome";
    let history = [];
    const maxSteps = 5;

    const popup = document.createElement('div');
    popup.className = 'glossary-popup';
    popup.innerHTML = `
      <button class="close-btn" onclick="closeGlossaryPopup()"><img src="img/close.svg" alt="Close"></button>
      <h3>Glosario</h3>
      <ul>
        <li id="glossary-1"><strong>Relámpagos¹</strong>: Descargas eléctricas visibles en el cielo durante tormentas.</li>
        <li id="glossary-2"><strong>Truenos²</strong>: Sonido fuerte causado por la expansión del aire caliente tras un relámpago.</li>
        <li id="glossary-3"><strong>Bultos³</strong>: Elevaciones visibles en una nube, como protuberancias redondeadas; míralas desde el suelo como "montañitas" en el cielo.</li>
        <li id="glossary-4"><strong>Nítido⁴</strong>: Borde claro y definido, sin difuminarse con el fondo.</li>
        <li id="glossary-5"><strong>Capa⁵</strong>: Una extensión continua de nubes que cubre una gran área del cielo, generalmente sin interrupciones significativas.</li>
        <li id="glossary-6"><strong>Difuso⁶</strong>: Borde borroso o poco claro, que parece desvanecerse.</li>
        <li id="glossary-7"><strong>Velo⁷</strong>: Capa delgada y transparente de nubes que deja ver el Sol o la Luna.</li>
        <li id="glossary-8"><strong>Halo⁸</strong>: Círculo de luz alrededor del Sol o la Luna, causado por cristales de hielo.</li>
        <li id="glossary-9"><strong>Grisáceo⁹</strong>: Color entre gris y blanco, típico de nubes con humedad.</li>
        <li id="glossary-10"><strong>Llovizna¹⁰</strong>: Lluvia muy fina y ligera con gotas pequeñas.</li>
        <li id="glossary-11"><strong>Niebla¹¹</strong>: Capa densa de pequeñas gotas de agua cerca del suelo.</li>
        <li id="glossary-12"><strong>Filamentos¹²</strong>: Hilos delgados y elongados formados por cristales de hielo en nubes altas.</li>
        <li id="glossary-13"><strong>Elementos¹³</strong>: Partes individuales visibles de una nube, como gotas o cristales de hielo.</li>
        <li id="glossary-14"><strong>Gránulos¹⁴</strong>: Pequeños puntos o bolitas visibles en una nube.</li>
        <li id="glossary-15"><strong>Ondulaciones¹⁵</strong>: Patrones ondulados o en forma de olas en las nubes.</li>
        <li id="glossary-16"><strong>Rodillos¹⁶</strong>: Formas cilíndricas o tubulares en las nubes.</li>
      </ul>
    `;
    document.body.appendChild(popup);

    const decisionTree = {
      welcome: { action: "start" },
      q1: {
        question: "¿Hay <span class='glossary-term' data-glossary='1'>relámpagos</span><span class='glossary-number'>¹</span> o <span class='glossary-term' data-glossary='2'>truenos</span><span class='glossary-number'>²</span>?",
        yes: { result: { name: "Cumulonimbus", description: "Nube alta y densa con forma de torre, de color gris oscuro, que puede traer tormentas fuertes, <span class='glossary-term' data-glossary='1'>relámpagos</span><span class='glossary-number'>¹</span> y lluvia intensa." } },
        no: "q2"
      },
      q2: {
        question: "¿La nube tiene <span class='glossary-term' data-glossary='3'>bultos</span><span class='glossary-number'>³</span> o parece hinchada?",
        yes: "q3",
        no: "q4"
      },
      q3: {
        question: "¿El borde superior de la nube es <span class='glossary-term' data-glossary='4'>nítido</span><span class='glossary-number'>⁴</span>?",
        yes: { result: { name: "Cumulonimbus", description: "Nube alta y densa con forma de torre, de color gris oscuro, que puede traer tormentas fuertes, <span class='glossary-term' data-glossary='1'>relámpagos</span><span class='glossary-number'>¹</span> y lluvia intensa." } },
        no: { result: { name: "Cumulus", description: "Nube blanca y esponjosa con bordes definidos, forma de copo, que aparece a mediana altura en días soleados, sin lluvia." } }
      },
      q4: {
        question: "¿La nube parece una <span class='glossary-term' data-glossary='5'>capa</span><span class='glossary-number'>⁵</span> extensa y lisa sin relieves?",
        yes: "q5",
        no: "q6"
      },
      q5: {
        question: "¿El Sol o la Luna se ven como un punto <span class='glossary-term' data-glossary='6'>difuso</span><span class='glossary-number'>⁶</span>?",
        yes: { result: { name: "Cirrostratus", description: "Nube alta y fina, de color blanco, que forma un <span class='glossary-term' data-glossary='7'>velo</span><span class='glossary-number'>⁷</span> y puede causar <span class='glossary-term' data-glossary='8'>halos</span><span class='glossary-number'>⁸</span> alrededor del Sol o la Luna, sin precipitaciones." } },
        no: "q7"
      },
      q7: {
        question: "¿La nube forma una <span class='glossary-term' data-glossary='5'>capa</span><span class='glossary-number'>⁵</span> alta de color <span class='glossary-term' data-glossary='9'>grisáceo</span><span class='glossary-number'>⁹</span>?",
        yes: { result: { name: "Altostratus", description: "Nube media, <span class='glossary-term' data-glossary='9'>grisácea</span><span class='glossary-number'>⁹</span> o azulada, que cubre el cielo uniformemente y puede traer lluvia ligera o nieve." } },
        no: "q8"
      },
      q8: {
        question: "¿La nube es una <span class='glossary-term' data-glossary='5'>capa</span><span class='glossary-number'>⁵</span> baja oscura que podría traer lluvia?",
        yes: { result: { name: "Nimbostratus", description: "Nube baja y oscura, <span class='glossary-term' data-glossary='9'>grisácea</span><span class='glossary-number'>⁹</span>, that cubre el cielo y produce lluvia o nieve constante." } },
        no: { result: { name: "Stratus", description: "Nube baja, <span class='glossary-term' data-glossary='9'>grisácea</span><span class='glossary-number'>⁹</span> y uniforme, que parece una <span class='glossary-term' data-glossary='5'>capa</span><span class='glossary-number'>⁵</span> y puede generar <span class='glossary-term' data-glossary='10'>llovizna</span><span class='glossary-number'>¹⁰</span> o <span class='glossary-term' data-glossary='11'>niebla</span><span class='glossary-number'>¹¹</span>." } }
      },
      q6: {
        question: "¿La nube tiene <span class='glossary-term' data-glossary='12'>filamentos</span><span class='glossary-number'>¹²</span> blancos y finos?",
        yes: { result: { name: "Cirrus", description: "Nube alta, blanca y delgada con <span class='glossary-term' data-glossary='12'>filamentos</span><span class='glossary-number'>¹²</span>, de aspecto plumoso, sin precipitaciones." } },
        no: "q9"
      },
      q9: {
        question: "¿Los <span class='glossary-term' data-glossary='13'>elementos</span><span class='glossary-number'>¹³</span> de la nube son pequeños como granos de arroz?",
        yes: { result: { name: "Cirrocumulus", description: "Nube alta, blanca, formada por pequeños <span class='glossary-term' data-glossary='14'>gránulos</span><span class='glossary-number'>¹⁴</span> o <span class='glossary-term' data-glossary='15'>ondulaciones</span><span class='glossary-number'>¹⁵</span>, sin lluvia." } },
        no: "q10"
      },
      q10: {
        question: "¿Los <span class='glossary-term' data-glossary='13'>elementos</span><span class='glossary-number'>¹³</span> de la nube son redondos y del tamaño de un dedo?",
        yes: { result: { name: "Altocumulus", description: "Nube media, blanca o <span class='glossary-term' data-glossary='9'>grisácea</span><span class='glossary-number'>⁹</span>, con <span class='glossary-term' data-glossary='15'>ondulaciones</span><span class='glossary-number'>¹⁵</span> o <span class='glossary-term' data-glossary='16'>rodillos</span><span class='glossary-number'>¹⁶</span>, que a veces precede a tormentas." } },
        no: { result: { name: "Stratocumulus", description: "Nube baja, <span class='glossary-term' data-glossary='9'>grisácea</span><span class='glossary-number'>⁹</span> o blanca, con <span class='glossary-term' data-glossary='3'>bultos</span><span class='glossary-number'>³</span> redondeados, que puede traer <span class='glossary-term' data-glossary='10'>llovizna</span><span class='glossary-number'>¹⁰</span> ligera." } }
      }
    };

    function startQuiz() {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          card.classList.remove("welcome");
          currentState = "q1";
          displayQuestion();
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function answer(response) {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          history.push({ state: currentState, response: response });
          const currentNode = decisionTree[currentState];
          const next = currentNode[response];
          if (typeof next === "string") {
            currentState = next;
            displayQuestion();
          } else if (next && next.result) {
            displayResult(next.result);
          }
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function goBack() {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          if (history.length > 0) {
            history.pop();
            const previous = history[history.length - 1];
            if (previous) {
              currentState = previous.state;
              displayQuestion();
            } else {
              currentState = "q1";
              displayQuestion();
            }
          } else {
            currentState = "welcome";
            card.classList.add("welcome");
            card.innerHTML = `
              <p class="welcome-text">Identificador de Nubes</p>
              <div class="button-container" id="buttons">
                <button class="button vamos" onclick="startQuiz()">¡Vamos!</button>
              </div>
            `;
          }
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function displayQuestion() {
      const card = document.getElementById("card");
      card.innerHTML = `
        <div class="contenedor-volver"><button id="back-btn" class="back-button" onclick="goBack()" style="display: none;">
          <img src="img/west.svg" alt="Back">
        </button> </div>
        <div class="contenedor-principal"> <div class="pregunta"><p class="question" id="question">${decisionTree[currentState].question}</p></div>
        <div class="button-container" id="buttons">
          <button id="${currentState}-yes" class="button derecha si" onclick="answer('yes')">Sí</button>
          <button id="${currentState}-no" class="button abajo no" onclick="answer('no')">No</button>
        </div>
        </div>
      `;
      setTimeout(setupGlossaryEvents, 0);
    }

    function displayResult(result) {
      const card = document.getElementById("card");
      card.innerHTML = `
        <div class="contenedor-volver"><button id="back-btn" class="back-button" onclick="goBack()" style="display: none;">
          <img src="img/west.svg" alt="Back">
        </button> </div>
        <div class="contenedor-principal"> <div class="respuesta"><h2 class="cloud-name">${result.name}</h2>
        <img src="/nubes/img/${result.name.toLowerCase()}.jpg" alt="${result.name}" style="max-width: 100%; height: auto; margin-top: 20px;" onclick="openGlossaryPopup()">
        <div class="description">${result.description}</div></div>
        <div class="button-container" id="buttons">
          <button id="restart-btn" class="button restart" onclick="restart()">Volver a empezar</button>
        </div>
      `;
      setTimeout(setupGlossaryEvents, 0);
    }

    function restart() {
      const card = document.getElementById("card");
      card.classList.add("blur");
      setTimeout(() => {
        card.innerHTML = '';
        setTimeout(() => {
          currentState = "q1";
          history = [];
          displayQuestion();
          updateProgress();
          toggleBackButton();
          card.classList.remove("blur");
        }, 100);
      }, 500);
    }

    function updateProgress() {
      const progressDot = document.getElementById("progress-dot");
      const progressBarWidth = document.querySelector(".progress-bar").offsetWidth;
      const steps = history.length;
      const isResult = decisionTree[currentState] && decisionTree[currentState].result !== undefined;
      const isWelcome = currentState === "welcome";

      let progressPercent;
      if (isWelcome) {
        progressPercent = 0;
      } else if (isResult) {
        progressPercent = 100;
      } else {
        progressPercent = (steps / maxSteps) * 100;
      }

      const dotPosition = (progressPercent / 100) * (progressBarWidth - 15);
      progressDot.style.left = `${dotPosition}px`;
    }

    function toggleBackButton() {
      const backButton = document.getElementById("back-btn");
      const isResult = decisionTree[currentState] && decisionTree[currentState].result !== undefined;
      const isWelcome = currentState === "welcome";

      if (backButton) {
        backButton.style.display = (!isWelcome && !isResult) ? "block" : "none";
      }
    }

    function setupGlossaryEvents() {
      const terms = document.querySelectorAll('.glossary-term');
      terms.forEach(term => {
        term.removeEventListener('click', handleGlossaryClick);
        term.addEventListener('click', handleGlossaryClick);
      });
    }

    function handleGlossaryClick(event) {
      const glossaryId = event.target.getAttribute('data-glossary');
      lastClickedGlossary = glossaryId;
      openGlossaryPopup();
    }

    let lastClickedGlossary = null;

    function openGlossaryPopup() {
      const popup = document.querySelector('.glossary-popup');
      if (popup) {
        popup.classList.add('open');
        if (lastClickedGlossary) {
          const element = document.getElementById(`glossary-${lastClickedGlossary}`);
          if (element) {
            element.scrollIntoView({ behavior: 'smooth', block: 'center' });
          }
        }
      }
    }

    function closeGlossaryPopup() {
      const popup = document.querySelector('.glossary-popup');
      if (popup) {
        popup.classList.remove('open');
      }
    }

    updateProgress();
    toggleBackButton();
  </script>
</body>
</html>
